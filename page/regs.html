<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- saved from url=(0049)http://localhost:8080/HouseRent/page/register.jsp -->
<HTML xmlns="http://www.w3.org/1999/xhtml"><HEAD><TITLE>惠民小家租房网 - 用户注册</TITLE>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
  <meta http-equiv="Access-Control-Allow-Origin" content="*">
  
<META name=GENERATOR content="MSHTML 8.00.7601.17514">
  <script type="text/javascript" src="../js/jquery-1.12.4.js"></script>
  
  <script type="text/javascript" src="../js/vue.min.js"></script>
  <script type="text/javascript" src="../js/axios.min.js"></script>
  <script type="text/javascript" src="../js/vue-router.min.js"></script>
   <!-- 引入 http-vue-loader 
   <script src="https://unpkg.com/http-vue-loader"></script>
   -->
<!-- 引入组件库 -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <link rel="stylesheet" href="../css/stylelogin.css">
  <link rel="stylesheet" href="../css/global.css">
  <LINK rel=stylesheet type=text/css href="../css/style.css">
  <link rel="stylesheet" href="../css/regs.css">
  <link rel="stylesheet" href="../css/stylelogin.css">
  <link rel="stylesheet" href="../css/global.css">
<style>
  
.jc-flex{
    display: flex;
    justify-content: center;
    align-items: center;
}
    .jc-range{
        width: 300px;
        border-radius:10px;
        background-color: #e9e9e9;
        position: relative;
        transition: 1s all;
        user-select: none;
        color: #585858;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 50px; /*no*/
    }
 .el-icon-success{
            position: absolute;
            width: 50px;/*no*/left: 0;
            height: 100%;border-radius:10px;
            color: #3fcd26;
            background:url(../images/login/ok.png) no-repeat 2px 50%;
            background-color: #fff;
            border: 1px solid #d8d8d8;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
 }   
.success{
        width: 300px;
        border-radius:10px;
        background-color: #3fcd26;
        position: relative;
        transition: 1s all;
        user-select: none;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 50px; /*no*/
        }
.el-icon-d-arrow-right{
            position: absolute;
            left: 0;border-radius:10px;
            width: 50px;/*nono-*/
            height: 100%;
            color: #585858;
            background:url(../images/login/heart.png) no-repeat 20px 50%; 
            background-color: #fff;
            border: 1px solid #d8d8d8;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            justify-content: center;
           align-items: center;
}


</style>


</HEAD>
<BODY>
  <div id="app" style="background: url(../images/login/logbg.jpg) no-repeat">
<DIV id=header class=wrap>
<DIV id=logo class="fl">
  <IMG src="../images/login/logo.png" width="240px" height="160px">
</DIV>
<p class="fl">惠民小家</p>
</DIV>
<DIV id=regLogin class=wrap>
<DIV class=dialog>
<DL class=clearfix>
  <DT>新用户注册</DT>
  <DD class=past>填写个人信息</DD></DL>
<DIV class=box>
<FORM action="" name="form1" id="form1">
<DIV class=infos>
<TABLE class=field>
  <TBODY>
  <TR>
    <TD class=field>用 户 名：</TD>
    <TD><INPUT class="text uname"  type=text v-model="yname" name=name @blur="yanzName(yname)"> 
    <span v-if="resultname == 1" style="color: rgb(13, 194, 67);">{{msgname}}</span>
    <span v-if="resultname == 0" style="color: red;">{{msgname}}</span>
    </TD></TR>
  <TR>
    <TD class=field>密　　码：</TD>
    <TD><INPUT class="text pw" type=password name=password v-model="password" @blur="yanzpw(password)">
      <span v-if="pwhint" style="color: rgb(13, 194, 67);">√</span>
      <span v-if="!pwhint" style="color: red;">*</span>
    </TD></TR>
  <TR>
    <TD class=field>确认密码：</TD>
    <TD><INPUT class="text repw" type=password name=repassword v-model="repassword"  @blur="yanzrepw(repassword)"> 
      <span v-if="repwhint" style="color: rgb(13, 194, 67);">√</span>
      <span v-if="!repwhint" style="color: red;">*</span>
    </TD></TR>
  <TR>
    <TD class=field>电　　话：</TD>
    <TD><INPUT class="text tel" type=text name=telephone v-model="tel" @blur="yanzTelephone(tel)"> 
      <span v-if="resultTelephone == 1" style="color: rgb(13, 194, 67);">{{msgTelephone}}</span>
      <span v-if="resultTelephone == 0" style="color: red;">{{msgTelephone}}</span>
    </TD></TR>
  <TR>
    <TD class=field>验  &nbsp;  证：</TD>
    <TD>
      <!--<INPUT class=text type=text name=username> -->
     
        <div class="jc-component__range">
               <div class="" :class="rangeStatus?'success':'jc-range'" >
                   <i @mousedown="rangeMove" :class="rangeStatus?successIcon:startIcon"></i>
                   {{rangeStatus?successText:startText}}
               </div>
            </div>

    </TD></TR>
  </TBODY>
</TABLE>
<DIV class=buttons>
<INPUT @click="regUser();" value=立即注册 type=button>
</DIV></DIV></FORM></DIV></DIV></DIV>

<div id="footer">
  <div class="footer-wrap cw">
      <div class="clear"></div>
      <div class="links fz0 text-center">
          <a href="#">关于我们</a>
          <a href="#">联系我们</a>
          <a href="#">人才招聘</a>
          <a href="regsmer.html">商家入驻</a>
          <a href="#">广告服务</a>
          <a href="#">友情链接</a>
          <a href="#">销售联盟</a>
          <a href="#">意见反馈</a>
          <a href="#">帮助中心</a>
      </div>
      <div class="copyright text-center">惠民小家租房网 © 2018 彡小小家 粤ICP证4056801号</div>
  </div>
</div>


</div>
</BODY></HTML>

<script>
  // 使用httpVueLoader  Vue.use(httpVueLoader);
       /*
		- 定义正则表达式规则：
			  - 用户名：至少6位到10位，以字母、下划线、$开头，后接字符。
			  - 密码：密码至少6位,最多10位。reg_pwd.test(this.password);
			  - 年龄：必须16-99岁。
			  - 邮箱验证：
			    	   1)以至少3位字母或数字开头
			       				   2)之后必须有一位@
			       				   3)@后必须有1位是小写的字母或数字
			       				   4)之后必须有一位.符号
			       				   5).符号后面由3位小写字母组成
			       				   6)之后可能又有.与2位小写字母结束
			  - 手机号:  以1开头，必须是11位数字。
		 * 
		 * */
     var reg_username = /^[a-z0-9A-Z_$\u4e00-\u9fa5]{4,9}$/;
		
    var reg_pwd = /^\w{6,16}$/;
    
    var reg_phone = /^1[35789]\d{9}$/;
    
  // 配置请求的基准URL地址
  axios.defaults.baseURL = 'http://localhost:8089/';

//在前端页面中设置支持sesson共享√
axios.defaults.withCredentials=true;


 var vue=new Vue({
   el:"#app",
   data:{
    resultname:0,
    msgname:'*',
    resultTelephone:0,
    msgTelephone:'*',
    yname:'',
    password:'',
    repassword:'',
    tel:'',
    pwhint:false,
    repwhint:false,
    //status: false,
    //成功图标
    successIcon: 'el-icon-success',
    //成功文字
    successText:'验证成功',
    //开始的图标
    startIcon: 'el-icon-d-arrow-right',
    //开始的文字
    startText:'请拖住滑块，拖动到最右边',
    //或者用值来进行监听
    status:"",
    disX : 0,
    rangeStatus: false,
   },
	components: {
    // 将组建加入组建库
    
	},created() {
    //Vue的方法给原生调用，则需要把方法挂在Window下面
    window.getmydate = this.getmydate;
   var checkStatus =(rule, value, callback) => {
      console.log(value);
      if (!value) {
        return callback(new Error("请拖动滑块完成验证"));
      } else {
        callback();
      }
    }
},
   mounted:function(){
 
   },
   methods: {
 
   yanzName:function(name){
       if(!reg_username.test(name)){
        this.resultname=0;
          this.msgname='*';
        alert("用户名必须至少4位到10位，非特殊符号。");
       }else{
      axios.get('users/getUserName',{params: {'name':name}}).then((ret) => {
          //获取后台数据
          this.resultname=ret.data.code;
          this.msgname=ret.data.message;
       });
       }
     },
     yanzpw:function(pw){
      if(!reg_pwd.test(pw)){
        this.pwhint=false;
					alert("密码至少6位,最多16位!");
				}else{
          this.pwhint=true;
        }
     },
     yanzrepw:function(pw){
      if(!reg_pwd.test(pw)){
        this.repwhint=false;
					alert("密码至少6位,最多16位!");
				}else{
          if(pw!=this.password){
            this.repwhint=false;
            alert("重新输入密码不一致!");
          }else{  
            this.repwhint=true;
          }
        }

     },
     yanzTelephone:function(tel){
      if(!reg_phone.test(tel)){
        this.resultTelephone=0;
        this.msgTelephone='*';
					alert("手机号格式不符合要求!");
				}else
      axios.get('users/getTelephone',{params: {'telephone':tel}}).then((ret) => {
          //获取后台数据
          this.resultTelephone=ret.data.code;
          this.msgTelephone=ret.data.message;
       });
     },
      //滑块移动
      rangeMove(e){
            let ele = e.target;
            let startX = e.clientX;
            let eleWidth = ele.offsetWidth;
            let parentWidth =  ele.parentElement.offsetWidth;
            let MaxX = parentWidth - eleWidth;
            if(this.rangeStatus){//不运行
                return false;
            }
            document.onmousemove = (e) => {
                let endX = e.clientX;
                this.disX = endX - startX;
                if(this.disX<=0){
                    this.disX = 0;
                }
                if(this.disX>=MaxX-eleWidth){//减去滑块的宽度,体验效果更好
                    this.disX = MaxX;
                }
                ele.style.transition = '.1s all';
                ele.style.transform = 'translateX('+this.disX+'px)';
                e.preventDefault();
            }
            document.onmouseup = ()=> {
                if(this.disX !== MaxX){
                    ele.style.transition = '.5s all';
                    ele.style.transform = 'translateX(0)';
                    //执行成功的函数
                    this.rangeStatus=false;
                }else{
                    this.rangeStatus = true;
                    if(this.status){
                        //this.$parent[this.status] = true;
                    }
                    //执行成功的函数
                    $(this).off("mousemove");
                    $(this).off("mouseup");
                }
                document.onmousemove = null;
                document.onmouseup = null;
            }
        }
    ,
    
     regUser:function(){  //注册事件

          if(!reg_username.test(this.yname)||!reg_pwd.test(this.password)||!reg_pwd.test(this.repassword)||!reg_phone.test(this.tel)){
            alert("请完成注册信息的正确填写！");
            return;
          }
          if(!this.rangeStatus){
            alert("请完成验证之后在注册！");
            return;
          }

           //获取表单数据，使有axios的post方法发送异步请求实现添加    注意:post方法默认不能传json  
          //使用FormData对象封装表单数据
          //1.基于表单创建FormData对象  var formdata=new FormData(表单);
          //理解为formdata就是一个键值对集合
          // 键（表单对象名称）   值(表单对象值)
          //表单对象的名称一定要和请求参数的名称对应

         var formData=new FormData(document.getElementById("form1"));
         axios.post(`users/regUser`,formData).then((ret) => {
            var result=ret.data.code;
            if(result==1)
            {
              //alert("注册成功");
              location.href="login.html";
            }else{
              alert("注册失败!"+ret.data.message);//不是给用户看的 前端开发人员看
            }
        });
    } 
   }
 });
</script>